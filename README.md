# Moodle Test Helper (Gemini via OpenRouter)

Этот UserScript помогает в прохождении тестов на платформе Moodle, интегрируя мощь языковой модели Google Gemini для получения ответов на вопросы. Скрипт добавляет специальную кнопку «ASK Gemini» к каждому вопросу в тесте.

## Возможности

*   **Универсальность**: Работает с большинством типов вопросов в Moodle, включая:
    *   Одиночный выбор (`multichoice`)
    *   Множественный выбор (`multianswer`)
    *   На сопоставление (`match`)
    *   Короткий ответ (`shortanswer`)
    *   И другие типы благодаря универсальному обработчику.
*   **Интеграция с Gemini**: Использует быструю и эффективную модель `google/gemini-2.5-flash` через сервис OpenRouter.ai для получения точных ответов.
*   **Автозаполнение**: Для вопросов типа "короткий ответ" скрипт автоматически вставляет полученный ответ в поле ввода.
*   **Удобный интерфейс**: Ответ от AI отображается в наглядном зеленом блоке прямо под вопросом.
*   **Простая настройка**: Скрипт сам запросит API ключ при первом использовании и сохранит его для будущих сессий.

> **⚠️ Внимание!**
> Использование данного скрипта может нарушать правила академической честности вашего учебного заведения. Используйте его на свой страх и риск, например, для самопроверки или тренировки. Автор не несет ответственности за возможные последствия.

## Требования

1.  **Браузер**: Любой современный браузер, поддерживающий расширения (например, Chrome, Firefox, Opera, Edge).
2.  **Расширение Userscript Manager**: Необходимо установить расширение, такое как **Tampermonkey** (рекомендуется) или Greasemonkey.
3.  **API ключ от OpenRouter.ai**: Для работы скрипта требуется ваш личный API ключ.

## Установка

1.  **Установите Tampermonkey**:
    *   [Для Google Chrome](https://chrome.google.com/webstore/detail/tampermonkey/dhdgffkkebhmkfjojejmpbldmpobfkfo)
    *   [Для Mozilla Firefox](https://addons.mozilla.org/ru/firefox/addon/tampermonkey/)
    *   [Для Microsoft Edge](https://microsoftedge.microsoft.com/addons/detail/tampermonkey/iikmkjmpaadaobahmlepeloendndfphd)

2.  **Установите скрипт**:
    *   Откройте панель управления Tampermonkey, нажав на иконку расширения в браузере.
    *   Перейдите на вкладку `Утилиты` и выберите "Создать новый скрипт".
    *   Полностью удалите шаблонный код, который там будет.
    *   Скопируйте **весь** предоставленный код скрипта и вставьте его в редактор.
    *   Нажмите `Файл` -> `Сохранить`.

Скрипт активируется автоматически, когда вы заходите на страницы тестов Moodle, указанные в `@match` (в данном случае `https://lms.kgeu.ru/mod/quiz/*`).

При первом использовании скрипта на странице теста Moodle появится всплывающее окно с просьбой ввести API ключ. Вставьте скопированный ключ в это окно и нажмите "ОК". Скрипт запомнит ваш ключ, и вам не придется вводить его снова.

## Как пользоваться

1.  Зайдите на страницу с тестом в Moodle (например, `https://lms.kgeu.ru/mod/quiz/attempt.php?...`).
2.  Под текстом каждого вопроса вы увидите синюю кнопку **«ASK Gemini»**.
3.  Нажмите на эту кнопку. Она изменит свой текст на «Думаю...», пока отправляется запрос к AI.
4.  Через несколько секунд под кнопкой появится зеленый блок с ответом от Gemini.
    *   Для вопросов с выбором ответа AI предложит правильный вариант.
    *   Для вопросов на сопоставление AI покажет пары "термин -> определение".
    *   Для вопросов с коротким ответом AI напишет предполагаемый ответ и **автоматически вставит его в поле ввода**.
5.  Если вы захотите отправить повторный запрос для того же вопроса, просто нажмите на кнопку еще раз (она станет активной после получения ответа).

## Устранение неполадок

*   **Кнопка не появляется**: Убедитесь, что скрипт включен в панели Tampermonkey и что URL-адрес страницы совпадает с тем, что указан в директиве `@match` в коде скрипта.
*   **Кнопка выдает ошибку**:
    1.  **Проверьте API ключ**: Возможно, вы ввели неверный ключ или на вашем аккаунте OpenRouter закончились средства (сервис платный, но предоставляет стартовый бесплатный баланс).
    2.  **Откройте консоль разработчика** (обычно клавиша F12, вкладка "Console"). Там могут быть подробные сообщения об ошибке, которые помогут понять причину проблемы.
*   **Ответ от AI некорректный**: Помните, что языковая модель не идеальна и может ошибаться. Всегда перепроверяйте ответы, особенно на важных тестах.
